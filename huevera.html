<!doctype html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hueveras de cart贸n 2</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.60.0/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <script>
        let canvas_w = 800;
        let canvas_h = 450;
        let gameOver = false;
        let fondoMusica, gameOverMusica, sonidoAgarre, sonidoCorrecta, sonidoIncorrecta;
        let tiempoRestante = 60;
        let textoTemporizador;
        let puntuacion = 0;
        let textoPuntuacion;
        let config = {
            type: Phaser.AUTO,
            width: canvas_w,
            height: canvas_h,
            scene: { preload, create, update }
        };
        let game = new Phaser.Game(config);
        let huevera_b, huevera_m, huevera_d;
        let huevo_shadow;
        let fondo, cinta;

        function preload() {
            this.load.image('huevera', 'huevera.png');
            this.load.image('huevo', 'huevo.png');
            this.load.image('fondo', 'fondo.png');
            this.load.image('cinta', 'cinta.png');
            this.load.audio('musica_fondo', 'musica_fondo.mp3');
            this.load.audio('musica_gameover', 'musica_gameover.mp3');
            this.load.audio('sonido_agarre', 'agarre.mp3');
            this.load.audio('sonido_correcto', 'correcto.mp3');
            this.load.audio('sonido_incorrecto', 'incorrecto.mp3');
        }

        function create() {
            fondo = this.add.image(canvas_w / 2, canvas_h / 2, 'fondo').setDisplaySize(canvas_w, canvas_h);
            cinta = this.add.image(150, canvas_h / 2, 'cinta').setScale(0.5, canvas_h);
            huevera_b = this.add.image(100, 100, 'huevera').setScale(0.5).setTint(0xffffff);
            huevera_m = this.add.image(100, 225, 'huevera').setScale(0.5).setTint(0x8B4513);
            huevera_d = this.add.image(100, 350, 'huevera').setScale(0.5).setTint(0xFFD700);

            huevo_shadow = this.add.image(-1000, -1000, 'huevo').setTint(0x000000).setAlpha(0.5);

            musicaFondo = this.sound.add('musica_fondo', { loop: true, volume: 0.5 });
            gameOverFondo = this.sound.add('musica_gameover', { loop: false, volume: 0.8 });
            sonidoAgarre = this.sound.add('sonido_agarre');
            sonidoCorrecto = this.sound.add('sonido_correcto');
            sonidoIncorrecto = this.sound.add('sonido_incorrecto');
            musicaFondo.play();

            textoTemporizador = this.add.text(20, 20, 'Tiempo: ' + tiempoRestante, { font: '32px Arial', fill: '#ffffff' });
            textoPuntuacion = this.add.text(canvas_w - 250, 20, 'Puntuaci贸n: ' + puntuacion, { font: '32px Arial', fill: '#ffffff' });

            this.time.addEvent({ delay: 1000, callback: actualizarTemporizador, callbackScope: this, loop: true });
            this.time.addEvent({ delay: 2000, callback: generarHuevoAleatorio, callbackScope: this, loop: true });

            this.input.on('drag', function (pointer, object, x, y) {
                sonidoAgarre.play();
                object.x = x;
                object.y = y;
                huevo_shadow.x = x + 8;
                huevo_shadow.y = y + 8;
            });

            this.input.on('dragend', function (pointer, object) {
                let correcto = false;
                let hueveras = [
                    { object: huevera_b, color: 0xffffff },
                    { object: huevera_m, color: 0x8B4513 },
                    { object: huevera_d, color: 0xFFD700 }
                ];

                for (let huevera of hueveras) {
                    if (Phaser.Geom.Intersects.RectangleToRectangle(huevera.object.getBounds(), object.getBounds())) {
                        if (object.tintTopLeft === huevera.color) {
                            puntuacion += obtenerPuntuacionHuevo(object);
                            if (huevera.color === 0xFFD700) tiempoRestante += 3;
                            textoTemporizador.setText('Tiempo: ' + tiempoRestante);
                            textoPuntuacion.setText('Puntuaci贸n: ' + puntuacion);
                            correcto = true;
                            object.destroy();
                            sonidoCorrecto.play();
                        }
                    }
                }

                if (!correcto) {
                    puntuacion = Math.max(puntuacion - 5, 0);
                    textoPuntuacion.setText('Puntuaci贸n: ' + puntuacion);
                    sonidoIncorrecto.play();
                }
            });
        }

        function obtenerPuntuacionHuevo(huevo) {
            switch (huevo.tintTopLeft) {
                case 0xffffff: return 10;
                case 0x8B4513: return 20;
                case 0xFFD700: return 30;
                default: return 0;
            }
        }

        function actualizarTemporizador() {
            if (!gameOver && tiempoRestante > 0) {
                tiempoRestante--;
                textoTemporizador.setText('Tiempo: ' + tiempoRestante);
            } else if (!gameOver) {
                darGameOver(this);
            }
        }

        function generarHuevoAleatorio() {
            const colores = [0xffffff, 0x8B4513, 0xFFD700];
            const color = Phaser.Utils.Array.GetRandom(colores);
            const x = Phaser.Math.Between(250, canvas_w - 50);

            let huevo = this.add.image(x, -50, 'huevo').setScale(0.5).setTint(color);
            huevo.setInteractive({ draggable: true });
            huevo.cayendo = this.tweens.add({
                targets: huevo,
                y: canvas_h + 50,
                duration: 5000,
                ease: 'Linear',
                onComplete: () => huevo.destroy()
            });

            huevo.on('dragstart', () => huevo.cayendo.pause());
        }

        function darGameOver(scene) {
            musicaFondo.stop();
            gameOverFondo.play();
            gameOver = true;
            textoTemporizador.setText('GAME OVER');
        }

        function update() { }
    </script>
</head>
<body>
</body>
</html>

